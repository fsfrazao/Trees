

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>tree_agent &mdash; trees_ibm 0.2.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="trees_ibm 0.2.2 documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> trees_ibm
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_description.html">Model Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">How to contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">trees_ibm</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>tree_agent</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tree_agent</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">py_ibm</span> <span class="k">import</span> <span class="o">*</span>
<span class="c1"># from plot_trees import plot_tree_pos</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">from</span> <span class="nn">tables</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<div class="viewcode-block" id="Tree"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree">[docs]</a><span class="k">class</span> <span class="nc">Tree</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents individual trees.</span>

<span class="sd">    Args:</span>
<span class="sd">        position: tuple</span>
<span class="sd">            (x,y) coordinates of where tree will be stablished.</span>
<span class="sd">        world : world object</span>
<span class="sd">            world where tree will live.</span>
<span class="sd">        dbh: float</span>
<span class="sd">            Diameter at Breast Height (in cm).</span>
<span class="sd">        h0: float:</span>
<span class="sd">            Height-stem diameter relationship parameter.</span>
<span class="sd">        h1: float</span>
<span class="sd">            Height-stem diameter relationship parameter.</span>
<span class="sd">        cl0: float</span>
<span class="sd">            Crown Length-Height relationship parameter.</span>
<span class="sd">        cd0: float</span>
<span class="sd">            Crown Diameter-Stem Diameter relationship parameter.</span>
<span class="sd">        cd1: float</span>
<span class="sd">            Crown Diameter-Stem Diameter relationship parameter.</span>
<span class="sd">        cd2: float</span>
<span class="sd">            Crown Diameter-Stem Diameter relationship parameter.</span>
<span class="sd">        rho: float</span>
<span class="sd">            Wood density in t of Organic Dry Matter/cubic meter.</span>
<span class="sd">        sigma: float</span>
<span class="sd">            Ratio of total aboveground biomass to stem biomass.</span>
<span class="sd">        f0: float</span>
<span class="sd">            Form factor-stem diameter relationship parameter.</span>
<span class="sd">        f1: float</span>
<span class="sd">            Form factor-stem diameter relationship parameter.</span>
<span class="sd">        l0: float</span>
<span class="sd">            Leaf Area Index (LAI)-Stem relationship parameter.</span>
<span class="sd">        l1: float</span>
<span class="sd">            Leaf Area Index (LAI)-Stem relationship parameter.</span>
<span class="sd">        m: float</span>
<span class="sd">            Light trasnmission coefficient.</span>
<span class="sd">        alpha: float</span>
<span class="sd">            Quantum eficiency; initial slope of the type speci
c light response curve.</span>
<span class="sd">        pmax: float</span>
<span class="sd">            Maximum leaf gross photosynthetic rate.</span>
<span class="sd">        rg: float</span>
<span class="sd">            Fraction of gross primary production available for growth that is attributed to growth respiration.</span>
<span class="sd">        deltaDmax: float</span>
<span class="sd">            Maximum diameter increment.</span>
<span class="sd">        DdeltaDmax: float</span>
<span class="sd">            % of Dmax that reaches deltaDmax.</span>
<span class="sd">        age: int</span>
<span class="sd">            Age (years).</span>
<span class="sd">        Ftype: str</span>
<span class="sd">            Functional type.</span>
<span class="sd">        Mb: float): backgroung mortality probability.</span>
<span class="sd">        Dfall: float</span>
<span class="sd">            Mimimum dbh for a tree to fall.</span>
<span class="sd">        pfall: float</span>
<span class="sd">            Probabbility that a tree with dbh&gt;Dfall will fall.</span>
<span class="sd">        m_max: float</span>
<span class="sd">            Maximum size-dependent mortality for small trees.</span>
<span class="sd">        Dmort: float</span>
<span class="sd">            DBH up to which mortality is increased (for small trees).</span>

<span class="sd">    Attributes:</span>

<span class="sd">        ID (int):</span>
<span class="sd">        Instances (dict):</span>
<span class="sd">        DeadTrees (dict):</span>

<span class="sd">        patch (tuple): (x,y) patch in which tree is located.</span>
<span class="sd">        f (float):</span>
<span class="sd">        k (float):</span>
<span class="sd">        lday (float):</span>
<span class="sd">        phi_act (float):</span>

<span class="sd">        H: float</span>
<span class="sd">            Height (m).</span>
<span class="sd">        CL: float</span>
<span class="sd">            Crown length (m).</span>
<span class="sd">        CD: float</span>
<span class="sd">            Crown diameter (m)</span>
<span class="sd">        CA: float</span>
<span class="sd">            Crown area (sq. m)</span>
<span class="sd">        AGB: float</span>
<span class="sd">            Above ground biomass (tODM)</span>
<span class="sd">        LAI: float</span>
<span class="sd">            Leaf area index.</span>
<span class="sd">        lmax: float</span>
<span class="sd">            Top layer occupied by this tree&#39;s crown.</span>
<span class="sd">        lmin: float</span>
<span class="sd">            Bottom layer occupied by this tree&#39;s crown.</span>
<span class="sd">        L_mean: float</span>
<span class="sd">            Average leaf area per layer.</span>
<span class="sd">        Li: float</span>
<span class="sd">            Amount of light receiveid by this tree.</span>
<span class="sd">        Mc: float</span>
<span class="sd">            Crowding mortality.</span>
<span class="sd">        basic_m: float</span>
<span class="sd">            Basic mortality.</span>
<span class="sd">        Mb: float</span>
<span class="sd">            Background mortality.</span>
<span class="sd">        Md: float</span>
<span class="sd">            Damage mortality.</span>
<span class="sd">        GPP: float</span>
<span class="sd">            Gross primary production in this time step.</span>
<span class="sd">        Rm: float</span>
<span class="sd">            Respiration maintenance in this timestep.</span>
<span class="sd">        position: tuple</span>
<span class="sd">            (x,y) coordinates of where tree is located.</span>
<span class="sd">        world: world object</span>
<span class="sd">            World where tree lives.</span>
<span class="sd">        dbh: float</span>
<span class="sd">            Diameter at Breast Height (in cm).</span>
<span class="sd">        h0: float</span>
<span class="sd">            Height-stem diameter relationship parameter.</span>
<span class="sd">        h1: float</span>
<span class="sd">            Height-stem diameter relationship parameter.</span>
<span class="sd">        cl0: float</span>
<span class="sd">            Crown Length-Height relationship parameter.</span>
<span class="sd">        cd0: float</span>
<span class="sd">            Crown Diameter-Stem Diameter relationship parameter.</span>
<span class="sd">        cd1: float</span>
<span class="sd">            Crown Diameter-Stem Diameter relationship parameter.</span>
<span class="sd">        cd2: float</span>
<span class="sd">            Crown Diameter-Stem Diameter relationship parameter.</span>
<span class="sd">        rho: float</span>
<span class="sd">            Wood density in t of Organic Dry Matter/cubic meter.</span>
<span class="sd">        sigma: float</span>
<span class="sd">            Ratio of total aboveground biomass to stem biomass.</span>
<span class="sd">        f0: float:</span>
<span class="sd">            Form factor-stem diameter relationship parameter.</span>
<span class="sd">        f1: float:</span>
<span class="sd">            Form factor-stem diameter relationship parameter.</span>
<span class="sd">        l0: float</span>
<span class="sd">            Leaf Area Index (LAI)-Stem relationship parameter.</span>
<span class="sd">        l1: float</span>
<span class="sd">            Leaf Area Index (LAI)-Stem relationship parameter.</span>
<span class="sd">        m: float</span>
<span class="sd">            Light trasnmission coefficient.</span>
<span class="sd">        alpha: float</span>
<span class="sd">            Quantum eciency; initial slope of the type-speci
c light response curve.</span>
<span class="sd">        pmax: float</span>
<span class="sd">            Maximum leaf gross photosynthetic rate.</span>
<span class="sd">        rg: float</span>
<span class="sd">            Fraction of gross primary production available for growth that is attributed to growth respiration.</span>
<span class="sd">        deltaDmax: float</span>
<span class="sd">            Maximum diameter increment.</span>
<span class="sd">        DdeltaDmax: float</span>
<span class="sd">            % of Dmax that reaches deltaDmax.</span>
<span class="sd">        age: int</span>
<span class="sd">            Age (years).</span>
<span class="sd">        Ftype:  str</span>
<span class="sd">            Functional type.</span>
<span class="sd">        Mb: float</span>
<span class="sd">            Backgroung mortality probability.</span>
<span class="sd">        max_height: float</span>
<span class="sd">            Maximum height this tree can reach.</span>
<span class="sd">        Dfall: float</span>
<span class="sd">            Mimimum dbh for a tree to fall.</span>
<span class="sd">        pfall: float</span>
<span class="sd">            Probabbility that a tree with dbh&gt;Dfall will fall.</span>
<span class="sd">        m_max: float)</span>
<span class="sd">            Maximum size-dependent mortality for small trees.</span>
<span class="sd">        Dmort: float</span>
<span class="sd">            DBH up to which mortality is increased (for small trees).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ID</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Instances</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">DERIVED_TREES</span> <span class="o">=</span> <span class="p">{}</span>
<div class="viewcode-block" id="Tree.TreeFactory"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.TreeFactory">[docs]</a>    <span class="n">DeadTrees</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">TreeFactory</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">new_cls_name</span><span class="p">,</span> <span class="n">new_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a Tree subclass to represent a Functional Type.</span>

<span class="sd">            Args:</span>
<span class="sd">                new_cls_name: str</span>
<span class="sd">                    Name of the functional type</span>

<span class="sd">                new_parameters: dict</span>
<span class="sd">                    Dictionary containing the the parameters specific to each functional type.</span>
<span class="sd">                    The following format is expected:</span>
<span class="sd">                        {&#39;h0&#39;:value,</span>
<span class="sd">                            &#39;h1&#39;:value,</span>
<span class="sd">                            &#39;cl0&#39;:value,</span>
<span class="sd">                            &#39;cd0&#39;:value,</span>
<span class="sd">                            &#39;cd1&#39;:value,</span>
<span class="sd">                            &#39;cd2&#39;:value,</span>
<span class="sd">                            &#39;rho&#39;:value,</span>
<span class="sd">                            &#39;sigma&#39;:value,</span>
<span class="sd">                            &#39;f0&#39;:value,</span>
<span class="sd">                            &#39;f1&#39;:value,</span>
<span class="sd">                            &#39;l0&#39;:value,</span>
<span class="sd">                            &#39;l1&#39;:value,</span>
<span class="sd">                            &#39;m&#39;:value,</span>
<span class="sd">                            &#39;alpha&#39;:value,</span>
<span class="sd">                            &#39;pmax&#39;:value,</span>
<span class="sd">                            &#39;max_dbh&#39;:value,</span>
<span class="sd">                            &#39;deltaDmax&#39;:value,</span>
<span class="sd">                            &#39;DdeltaDmax&#39;:value,</span>
<span class="sd">                            &#39;Dmort&#39;:value,</span>
<span class="sd">                            &#39;Dfall&#39;:value,</span>
<span class="sd">                            &#39;pfall&#39;:value,</span>
<span class="sd">                            &#39;rg&#39;:value,</span>
<span class="sd">                            &#39;m_max&#39;:value,</span>
<span class="sd">                        }</span>

<span class="sd">                Returns: Tree subclass</span>
<span class="sd">                    A subclass of the Tree class with the provided parameter values as default.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">def</span> <span class="nf">new_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="n">dbh</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">=</span> <span class="n">dbh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>

            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">patch</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="nb">int</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h0</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;h0&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h1</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;h1&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cl0</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;cl0&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cd0</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;cd0&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cd1</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;cd1&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cd2</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;cd2&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f0</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f1</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_f</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l0</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;l0&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="mf">0.7</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lday</span> <span class="o">=</span> <span class="mi">12</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi_act</span> <span class="o">=</span> <span class="mi">30</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pmax</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;pmax&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;max_dbh&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">100.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deltaDmax</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;deltaDmax&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DdeltaDmax</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;DdeltaDmax&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dmort</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;Dmort&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dfall</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;Dfall&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pfall</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;pfall&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_alpha0</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_alpha1</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rg</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;rg&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ftype</span> <span class="o">=</span> <span class="n">new_cls_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_max</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;m_max&#39;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CL</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CD</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CA</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AGB</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LAI</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L_mean</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Li</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Mc</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basic_m</span> <span class="o">=</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;Mb&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Mb</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Md</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GPP</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Gpp in this time step</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rm</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Rm in this timestep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">available_fruits</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># self.update()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">trees_per_patch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># self.id=Tree.ID</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="n">Tree</span><span class="o">.</span><span class="n">IncrementID</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">new_attr_met</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Nseed&#39;</span><span class="p">:</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;Nseed&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;Nfruit&#39;</span><span class="p">:</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;Nfruit&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;Fdisp&#39;</span><span class="p">:</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;Fdisp&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;Adisp&#39;</span><span class="p">:</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;Adisp&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;Indices&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s1">&#39;Ftype&#39;</span><span class="p">:</span> <span class="n">new_cls_name</span><span class="p">,</span>
                        <span class="s1">&#39;Iseed&#39;</span><span class="p">:</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;Iseed&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;h0&#39;</span><span class="p">:</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;h0&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;h1&#39;</span><span class="p">:</span> <span class="n">new_parameters</span><span class="p">[</span><span class="s1">&#39;h1&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;__init__&#39;</span><span class="p">:</span> <span class="n">new_init</span><span class="p">}</span>

        <span class="n">new_cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">new_cls_name</span><span class="p">,</span> <span class="p">(</span><span class="n">cls</span><span class="p">,),</span> <span class="n">new_attr_met</span><span class="p">)</span>

        <span class="n">cls</span><span class="o">.</span><span class="n">DERIVED_TREES</span><span class="p">[</span><span class="n">new_cls_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_cls</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">DeadTrees</span><span class="p">[</span><span class="n">new_cls_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>

        <span class="k">return</span> <span class="n">new_cls</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">FTPopulation</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">ft</span><span class="p">):</span>
<div class="viewcode-block" id="Tree.CountFruits"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.CountFruits">[docs]</a>        <span class="k">pass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">CountFruits</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Counts the total number of fruits in the landscape.</span>
<span class="sd">            Fruits from all trees of all Functional Types are counted.</span>

<span class="sd">            Returns: int</span>
<span class="sd">                Number of fruits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fruits</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">values</span><span class="p">():</span></div>
            <span class="n">fruits</span> <span class="o">+=</span> <span class="n">t</span><span class="o">.</span><span class="n">available_fruits</span>
<div class="viewcode-block" id="Tree.UpdateTrees"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.UpdateTrees">[docs]</a>        <span class="k">return</span> <span class="n">fruits</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">UpdateTrees</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates all living trees</span>

<span class="sd">            Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<div class="viewcode-block" id="Tree.ProduceFruits"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.ProduceFruits">[docs]</a>            <span class="n">t</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ProduceFruits</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Makes all trees with diameter bigger than 10 cm produce fruits.</span>

<span class="sd">            Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">values</span><span class="p">():</span></div>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">DBH</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
<div class="viewcode-block" id="Tree.DisperseSeeds"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.DisperseSeeds">[docs]</a>                <span class="n">t</span><span class="o">.</span><span class="n">available_fruits</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">fruits_from_DBH</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">DisperseSeeds</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes all trees with diameter bigger than 10 cm disperse their seeds.</span>

<span class="sd">            Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">values</span><span class="p">():</span></div>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">DBH</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
<div class="viewcode-block" id="Tree.TreesAboveDBH"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.TreesAboveDBH">[docs]</a>                <span class="n">t</span><span class="o">.</span><span class="n">disperse_seeds</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">Adisp</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">Fdisp</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">TreesAboveDBH</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbh</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the total number of trees with DBH above the speciefied threshold.</span>

<span class="sd">        Returns: int</span>
<span class="sd">            Number of trees.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span></div>
        <span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">DBH</span> <span class="o">&gt;=</span> <span class="n">dbh</span><span class="p">]</span>
<div class="viewcode-block" id="Tree.Total_AGB"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.Total_AGB">[docs]</a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">trees</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Total_AGB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate the total Above Ground Biomass for all living trees.</span>

<span class="sd">        Returns: float</span>
<span class="sd">            Total Aboveground Biomass in tons of Organic Dry matter (tODM).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Tagb</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>
            <span class="n">Tagb</span> <span class="o">+=</span> <span class="n">t</span><span class="o">.</span><span class="n">AGB</span>
<div class="viewcode-block" id="Tree.Cgpp"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.Cgpp">[docs]</a>        <span class="k">return</span> <span class="n">Tagb</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Cgpp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate the total Carbon absorbed as Gross Primary Production.</span>

<span class="sd">        Returns: float</span>
<span class="sd">            Total Carbon absorbed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Cgpp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>
            <span class="n">Cgpp</span> <span class="o">+=</span> <span class="n">t</span><span class="o">.</span><span class="n">GPP</span>
<div class="viewcode-block" id="Tree.Cr"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.Cr">[docs]</a>        <span class="k">return</span> <span class="mf">0.44</span> <span class="o">*</span> <span class="n">Cgpp</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Cr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate the total Carbon released through respiration.</span>

<span class="sd">        Returns: float</span>
<span class="sd">            Total Carbon released by all living trees.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c1"># Cr+=(t.Rm+t.rg*(t.GPP-t.Rm))</span></div>
            <span class="n">Cr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">Rm</span><span class="p">)</span>
<div class="viewcode-block" id="Tree.Mortality"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.Mortality">[docs]</a>        <span class="k">return</span> <span class="mf">0.44</span> <span class="o">*</span> <span class="n">Cr</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Mortality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kill trees by calling their stochastic_M() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">:</span></div>
            <span class="k">if</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">stochastic_M</span><span class="p">():</span>
<div class="viewcode-block" id="Tree.BackgroundMortality"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.BackgroundMortality">[docs]</a>                <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">remove_me</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">BackgroundMortality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kill trees by calling their stochastic_Bm() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">:</span></div>
            <span class="k">if</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">stochastic_Bm</span><span class="p">():</span>
<div class="viewcode-block" id="Tree.CrowdingMortality"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.CrowdingMortality">[docs]</a>                <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">remove_me</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">CrowdingMortality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kill trees by calling their stochastic_Cm() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">:</span></div>
            <span class="k">if</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">stochastic_Cm</span><span class="p">():</span>
<div class="viewcode-block" id="Tree.DamageMortality"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.DamageMortality">[docs]</a>                <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">remove_me</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">DamageMortality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kill trees by calling their stochastic_Dm() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">:</span></div>
            <span class="k">if</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">stochastic_Dm</span><span class="p">():</span>
                <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">remove_me</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ActiveAgents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<div class="viewcode-block" id="Tree.TreesPerPatch"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.TreesPerPatch">[docs]</a>        <span class="k">return</span> <span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">ag</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">TreesPerPatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Identify which trees are in each patch.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): keys are patch coordinates &#39;(x,y)&#39; and values are lists of trees ids in that patch.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">patches</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">patch</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">patches</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">patch</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span></div>
                <span class="n">patches</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<div class="viewcode-block" id="Tree.MaxHeight"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.MaxHeight">[docs]</a>        <span class="k">return</span> <span class="n">patches</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">MaxHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Finds the height of the tallest tree in the current time step.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): height of the tallest tree.</span>
</div>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">H</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Tree type: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="n">dbh</span><span class="p">,</span> <span class="n">wood_density</span><span class="p">,</span> <span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">cl0</span><span class="p">,</span> <span class="n">cd0</span><span class="p">,</span> <span class="n">cd1</span><span class="p">,</span> <span class="n">cd2</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">l0</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">pmax</span><span class="p">,</span> <span class="n">max_agb</span><span class="p">,</span> <span class="n">rg</span><span class="p">,</span> <span class="n">deltaDmax</span><span class="p">,</span> <span class="n">DdeltaDmax</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">Ftype</span><span class="p">,</span> <span class="n">Mb</span><span class="p">,</span> <span class="n">Dfall</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">pfall</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">m_max</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">Dmort</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_dbh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
        <span class="c1"># self.AddInstance(self.id)</span>
        <span class="c1">#Tree.Instances[Ftype+&#39; &#39;+str(self.id)]=self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">=</span> <span class="n">dbh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftype</span> <span class="o">=</span> <span class="n">Ftype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wood_density</span> <span class="o">=</span> <span class="n">wood_density</span>
        <span class="c1"># type specific parameter used to calculate tree height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h0</span> <span class="o">=</span> <span class="n">h0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h1</span> <span class="o">=</span> <span class="n">h1</span>
        <span class="c1"># type specific parameter used to calculate crown length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cl0</span> <span class="o">=</span> <span class="n">cl0</span>
        <span class="c1"># type specific parameter used to calculate crown diameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cd0</span> <span class="o">=</span> <span class="n">cd0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cd1</span> <span class="o">=</span> <span class="n">cd1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cd2</span> <span class="o">=</span> <span class="n">cd2</span>
        <span class="c1"># type specific parameter used to calculate aboveground biomass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f0</span> <span class="o">=</span> <span class="n">f0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f1</span> <span class="o">=</span> <span class="n">f1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_f</span><span class="p">()</span>
        <span class="c1"># type specific parameter used to calculate the leaf area index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l0</span> <span class="o">=</span> <span class="n">l0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">=</span> <span class="n">l1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lday</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">lday</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_act</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">phi_act</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmax</span> <span class="o">=</span> <span class="n">pmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_max</span> <span class="o">=</span> <span class="n">m_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Dmort</span> <span class="o">=</span> <span class="n">Dmort</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Dfall</span> <span class="o">=</span> <span class="n">Dfall</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfall</span> <span class="o">=</span> <span class="n">pfall</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span> <span class="o">=</span> <span class="n">max_dbh</span> <span class="o">/</span> <span class="mf">100.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltaDmax</span> <span class="o">=</span> <span class="n">deltaDmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DdeltaDmax</span> <span class="o">=</span> <span class="n">DdeltaDmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_alpha0</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_alpha1</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rg</span> <span class="o">=</span> <span class="n">rg</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CL</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CD</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CA</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AGB</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LAI</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_mean</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Li</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_m</span> <span class="o">=</span> <span class="n">Mb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_fruits</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mb</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Md</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GPP</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Gpp in this time step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rm</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Rm in this timestep</span>
        <span class="c1"># self.update()</span>
<div class="viewcode-block" id="Tree.update"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.update">[docs]</a>        <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">trees_per_patch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Updates geometry related parameters and mortality probabilities.</span>

<span class="sd">            Returns: dict</span>
<span class="sd">                A dictionary with the new attribute values.</span>
<span class="sd">                Can be imported by the &#39;import_attributes&#39; method.</span>

<span class="sd">                The following attributes are returned:</span>

<span class="sd">                {&quot;DBH&quot;:value,</span>
<span class="sd">                &quot;H&quot;:value,</span>
<span class="sd">                &quot;CL&quot;:value,</span>
<span class="sd">                &quot;CD&quot;:value,</span>
<span class="sd">                &quot;CA&quot;:value,</span>
<span class="sd">                &quot;AGB&quot;:value,</span>
<span class="sd">                &quot;LAI&quot;:value,</span>
<span class="sd">                &quot;lmax&quot;:value,</span>
<span class="sd">                &quot;lmin&quot;:value,</span>
<span class="sd">                &quot;L_mean&quot;:value,</span>
<span class="sd">                &quot;Li&quot;:value,</span>
<span class="sd">                &quot;Mc&quot;:value,</span>
<span class="sd">                &quot;Mb&quot;:value,</span>
<span class="sd">                &quot;age&quot;:value,</span>
<span class="sd">                &quot;available_fruits&quot;:value,</span>
<span class="sd">            }</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H_from_DBH</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CL_from_H</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CD_from_DBH</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CA_from_CD</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AGB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGB_from_DBH</span><span class="p">(</span><span class="n">D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LAI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LAI_from_DBH</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">delta_h</span>  <span class="c1"># eq.31</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmin</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">CL</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">delta_h</span>  <span class="c1"># eq.32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_mean</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LAI</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CA</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">-</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">lmin</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmin</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># eq.34</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Li</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lind</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_Rc</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mb</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_m</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_Ms</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Md</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># self.available_fruits+=self.fruits_from_DBH()</span>

        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;DBH&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span><span class="p">,</span>
                      <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">,</span>
                      <span class="s2">&quot;CL&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">CL</span><span class="p">,</span>
                      <span class="s2">&quot;CD&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">CD</span><span class="p">,</span>
                      <span class="s2">&quot;CA&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">CA</span><span class="p">,</span>
                      <span class="s2">&quot;AGB&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGB</span><span class="p">,</span>
                      <span class="s2">&quot;LAI&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">LAI</span><span class="p">,</span>
                      <span class="s2">&quot;lmax&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span><span class="p">,</span>
                      <span class="s2">&quot;lmin&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmin</span><span class="p">,</span>
                      <span class="s2">&quot;L_mean&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_mean</span><span class="p">,</span>
                      <span class="s2">&quot;Li&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Li</span><span class="p">,</span>
                      <span class="s2">&quot;Mc&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mc</span><span class="p">,</span>
                      <span class="s2">&quot;Mb&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mb</span><span class="p">,</span>
                      <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="p">,</span>
                      <span class="s2">&quot;available_fruits&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_fruits</span><span class="p">,</span> <span class="p">}</span></div>

<div class="viewcode-block" id="Tree.import_attributes"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.import_attributes">[docs]</a>        <span class="k">return</span> <span class="p">(</span><span class="n">attributes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">import_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Updates this tree&#39;s attributes with the values in &#39;attributes&#39;.</span>

<span class="sd">            Args:</span>
<span class="sd">                attributes: dict</span>
<span class="sd">                    A dict with attribute name : value.</span>
<span class="sd">                    The following attributes are expected:</span>

<span class="sd">                    {&quot;DBH&quot;:value,</span>
<span class="sd">                    &quot;H&quot;:value,</span>
<span class="sd">                    &quot;CL&quot;:value,</span>
<span class="sd">                    &quot;CD&quot;:value,</span>
<span class="sd">                    &quot;CA&quot;:value,</span>
<span class="sd">                    &quot;AGB&quot;:value,</span>
<span class="sd">                    &quot;LAI&quot;:value,</span>
<span class="sd">                    &quot;lmax&quot;:value,</span>
<span class="sd">                    &quot;lmin&quot;:value,</span>
<span class="sd">                    &quot;L_mean&quot;:value,</span>
<span class="sd">                    &quot;Li&quot;:value,</span>
<span class="sd">                    &quot;Mc&quot;:value,</span>
<span class="sd">                    &quot;Mb&quot;:value,</span>
<span class="sd">                    &quot;age&quot;:value,</span>
<span class="sd">                    &quot;available_fruits&quot;:value,</span>
<span class="sd">                }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;DBH&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CL</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;CL&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CD</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;CD&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CA</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AGB</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;AGB&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LAI</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;lmax&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmin</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;lmin&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L_mean</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;L_mean&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Li</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;Li&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mc</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;Mc&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mb</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;Mb&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">Md</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_fruits</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;available_fruits&quot;</span><span class="p">]</span>
<div class="viewcode-block" id="Tree.fruits_from_DBH"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.fruits_from_DBH">[docs]</a>        <span class="c1"># self.age+=1</span>

    <span class="k">def</span> <span class="nf">fruits_from_DBH</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculates the number of new fruits based on stem diameter</span>

<span class="sd">            TODO:</span>
<span class="sd">                *Make  &#39;adj&#39; a functional type level parameter (a class attribute)</span>

<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="n">adj</span><span class="o">=</span><span class="mf">0.01</span>
<div class="viewcode-block" id="Tree.H_from_DBH"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.H_from_DBH">[docs]</a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nfruit</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">DBH</span><span class="o">*</span><span class="n">adj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">H_from_DBH</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate tree height calculated according to eq.1 in SI-Fisher et al.(2015).</span>

<span class="sd">        Returns: float</span></div>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Tree.CL_from_H"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.CL_from_H">[docs]</a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">h0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">h1</span>

    <span class="k">def</span> <span class="nf">CL_from_H</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate tree crown_length (CL) calculated according to eq.2 in SI-Fisher et al.(2015)</span>

<span class="sd">        Returns: float</span></div>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Tree.CD_from_DBH"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.CD_from_DBH">[docs]</a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cl0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span>

    <span class="k">def</span> <span class="nf">CD_from_DBH</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate tree crown diameter (CD) calculated according to eq.3 in SI-Fisher et al.(2015).</span>

<span class="sd">        Returns: float</span></div>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Tree.CA_from_CD"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.CA_from_CD">[docs]</a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cd0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">cd1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cd2</span>

    <span class="k">def</span> <span class="nf">CA_from_CD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate tree crown area (CA) calculated according to eq.4 in SI-Fisher et al.(2015)</span>

<span class="sd">        Returns: float</span></div>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Tree.calculate_volume"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.calculate_volume">[docs]</a>        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CD</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate the volume of the stem based on DBH.</span>

<span class="sd">        Returns: float</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="Tree.AGB_from_DBH"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.AGB_from_DBH">[docs]</a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">AGB_from_DBH</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate tree aboveground biomass (AGB) calculated according to eq.5 in SI-Fisher et al.(2015)</span>

<span class="sd">        Returns: float</span>

<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="Tree.calculate_f"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.calculate_f">[docs]</a>        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">D</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the form factor (f) calculated according to eq.6 in SI-Fisher et al.(2015)</span>

<span class="sd">        Returns: float</span>

<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="Tree.LAI_from_DBH"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.LAI_from_DBH">[docs]</a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">f0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">f1</span>

    <span class="k">def</span> <span class="nf">LAI_from_DBH</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the leaf area index (LAI) calculated according to eq.7 in SI-Fisher et al.(2015)</span>

<span class="sd">        Returns: float</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="Tree.decrement_fruit_stock"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.decrement_fruit_stock">[docs]</a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">l0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span>

    <span class="k">def</span> <span class="nf">decrement_fruit_stock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Decreases the fruit stock bt n.</span>

<span class="sd">            Args:</span>
<span class="sd">                n: int</span>
<span class="sd">                    Number of fruits</span>
</div>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Tree.disperse_seeds"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.disperse_seeds">[docs]</a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_fruits</span> <span class="o">-=</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">disperse_seeds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">maximum_distance</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Disperse seeds according to a power distribution.</span>

<span class="sd">            Seeds are deposited in the topology&#39;s seedbank.</span>

<span class="sd">            Power function:</span>
<span class="sd">                    P(x|a)=a*x^(a-1)</span>

<span class="sd">            Args:</span>
<span class="sd">                fraction: float</span>
<span class="sd">                    Fraction (between 0.0 and 1.0) of the available fruits to be dispersed ( each fruit contains one seed).</span>
<span class="sd">                a: float</span>
<span class="sd">                    Power factor</span>

<span class="sd">                maximum_distance: float</span>
<span class="sd">                        Maximun distance (from the tree) at which a seed can be deposited.</span>

<span class="sd">            Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">n_seeds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_fruits</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decrement_fruit_stock</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_seeds</span><span class="p">)</span>
        <span class="n">seed_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_seeds</span><span class="p">)</span>
        <span class="n">max_distance</span> <span class="o">=</span> <span class="n">maximum_distance</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">patch_area</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">seed_distances</span><span class="p">:</span>
            <span class="n">seed_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_seed_position</span><span class="p">(</span></div>
                <span class="n">distance</span><span class="o">=</span><span class="n">d</span> <span class="o">*</span> <span class="n">max_distance</span><span class="p">)</span>
<div class="viewcode-block" id="Tree.random_seed_position"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.random_seed_position">[docs]</a>            <span class="bp">self</span><span class="o">.</span><span class="n">deposit_seed</span><span class="p">(</span><span class="n">seed_position</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">random_seed_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Randomly selects a point within a circle of radius= &#39;distance&#39; for a seed to be deposited.</span>

<span class="sd">            Args:</span>
<span class="sd">                distance: float</span>
<span class="sd">                    Maximun distance (from the tree) at which a seed can be deposited.</span>

<span class="sd">            Returns: tuple</span>
<span class="sd">                    (x,y) seed position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
        <span class="n">new_position</span> <span class="o">=</span> <span class="p">((</span><span class="n">x0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">distance</span><span class="p">,</span>
                         <span class="n">y0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">distance</span><span class="p">))</span></div>
        <span class="n">verified_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">in_bounds</span><span class="p">(</span><span class="n">new_position</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">verified_position</span>

    <span class="k">def</span> <span class="nf">deposit_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed_position</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">seedbank</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftype</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seed_position</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">add_seed_entry</span><span class="p">(</span><span class="n">tree_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">initial_x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="n">initial_y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">final_x</span><span class="o">=</span><span class="n">seed_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">final_y</span><span class="o">=</span><span class="n">seed_position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                      <span class="n">dispersal_type</span><span class="o">=</span><span class="s2">&quot;non-zoochoric&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
<div class="viewcode-block" id="Tree.Lind"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.Lind">[docs]</a>            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">Lind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the incoming radiation on top of lmax layer the tree is reaching according to eq.36 in SI-Fisher et al.(2015).</span>

<span class="sd">        Returns: float</span>
<span class="sd">            Incoming radiation on top of this tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># crown_layers=(np.ceil(self.lmax)-np.floor(self.lmin))/self.world.topology.delta_h</span>
        <span class="n">patch_LI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">LAIs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">]</span>
        <span class="n">top_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmax</span><span class="p">))</span>  <span class="c1"># /self.world.topology.delta_h)</span>
        <span class="n">patch_LI</span> <span class="o">=</span> <span class="n">patch_LI</span><span class="p">[</span><span class="n">top_layer</span><span class="p">:]</span>

        <span class="c1"># self.patch_LI=sum(patch_LI)</span></div>

<div class="viewcode-block" id="Tree.Pind"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.Pind">[docs]</a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">patch_LI</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">Pind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Li</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate the interim gross photosynthetic rate of one tree per year, according to eq.40 in SI-Fisher et al.(2015)</span>

<span class="sd">        Returns: float</span>
<span class="sd">            Gross photosynthetic rate.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pmk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmax</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">aki</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">Li</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmax</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>

        <span class="n">pind</span> <span class="o">=</span> <span class="n">pmk</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">aki</span> <span class="o">+</span> <span class="n">pm</span><span class="p">)</span> <span class="o">/</span>
                            <span class="p">(</span><span class="n">aki</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">LAI</span><span class="p">)</span> <span class="o">+</span> <span class="n">pm</span><span class="p">))</span>
</div>
        <span class="c1"># Tons of organic dry meter per year (todm.y-1)</span>
<div class="viewcode-block" id="Tree.calculate_rm"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.calculate_rm">[docs]</a>        <span class="k">return</span> <span class="n">pind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CA</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lday</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_act</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.63</span> <span class="o">*</span> <span class="mi">44</span>

    <span class="k">def</span> <span class="nf">calculate_rm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the maintenance respiration rate(rm) according to eq.46 in SI-Fisher et al.(2015).</span>

<span class="sd">        Returns: float</span>
<span class="sd">                &quot;&quot;&quot;</span>

        <span class="n">max_Li</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">I0</span>

        <span class="n">rm</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGB</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Pind</span><span class="p">(</span><span class="n">max_Li</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AGB_from_DBH</span><span class="p">(</span><span class="n">D</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">/</span>
                                                                                 <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">growth</span><span class="p">(</span><span class="n">D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGB</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rg</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Tree.growth"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.growth">[docs]</a>        <span class="k">return</span> <span class="n">rm</span>

    <span class="k">def</span> <span class="nf">growth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the yearly diameter growth according to eq.48 in SI-Fisher et al.(2015). Assumes full availabilty of resources</span>

<span class="sd">        Returns: float</span>
<span class="sd">            Diameter growth.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="Tree.calculate_alpha0"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.calculate_alpha0">[docs]</a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha0</span> <span class="o">*</span> <span class="n">D</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">D</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span><span class="p">)))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha1</span> <span class="o">*</span> <span class="n">D</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_alpha0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the alpha0 growth paramenter, according equations described in sctions F-5 (page 24) of SI-Fisher et al.(2015).</span>

<span class="sd">        Returns: float</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DdeltaDmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span><span class="p">)</span>
                      <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DdeltaDmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span><span class="p">)))</span>
        <span class="n">alpha0</span> <span class="o">=</span> <span class="n">exp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaDmax</span>
        <span class="n">alpha0</span> <span class="o">=</span> <span class="n">alpha0</span> <span class="o">/</span> \
            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DdeltaDmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span><span class="p">))</span>
             <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DdeltaDmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span><span class="p">))</span></div>

<div class="viewcode-block" id="Tree.calculate_alpha1"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.calculate_alpha1">[docs]</a>        <span class="k">return</span> <span class="n">alpha0</span>

    <span class="k">def</span> <span class="nf">calculate_alpha1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate alpha1 growth paramenter, according equations described in sctions F-5 (page 24) of SI-Fisher et al.(2015).</span>

<span class="sd">        Returns: float</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">alpha1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DdeltaDmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span><span class="p">)</span>
        <span class="n">alpha1</span> <span class="o">=</span> <span class="n">alpha1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DdeltaDmax</span> <span class="o">*</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DdeltaDmax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmax</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tree.Biomass_gain"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.Biomass_gain">[docs]</a>        <span class="k">return</span> <span class="n">alpha1</span>

    <span class="k">def</span> <span class="nf">Biomass_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate Aboveground Biomass (AGB) gain according to eq.43 in SI-Fisher et al.(2015).</span>

<span class="sd">        Returns: float</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">GPP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Li</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rm</span> <span class="o">=</span> <span class="mf">0.47</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GPP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_rm</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGB</span>
        <span class="c1"># self.Rm=self.r0*self.AGB+self.r1*self.AGB**2+self.r2*self.AGB**3</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GPP</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rm</span><span class="p">)</span>
        <span class="c1"># gain=self.GPP-self.Rm</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">AGB</span> <span class="o">+=</span> <span class="n">gain</span>
<div class="viewcode-block" id="Tree.DBH_from_Biomass"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.DBH_from_Biomass">[docs]</a>        <span class="k">return</span> <span class="n">gain</span>

    <span class="k">def</span> <span class="nf">DBH_from_Biomass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate diameter at breast height from above ground biomass.</span>

<span class="sd">        Returns: float</span>
<span class="sd">            The DBH calculated from AGB.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>
        <span class="c1"># if p&gt;0 and B&gt;0:</span>
        <span class="n">dbh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dbh</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dbh</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span></div>
            <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># if Biomass is negative, new DBH will be 0</span>
<div class="viewcode-block" id="Tree.increase_DBH"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.increase_DBH">[docs]</a>        <span class="k">return</span> <span class="n">dbh</span>

    <span class="k">def</span> <span class="nf">increase_DBH</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Increase tree DBH according to gain in biomass.</span>

<span class="sd">        Note: If DBH decreases to zero, remove tree.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Biomass_gain</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AGB</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">gain</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_me</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># new_B=self.AGB+self.Biomass_gain()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBH_from_Biomass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AGB</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span></div>
            <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DBH</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_me</span><span class="p">()</span>
        <span class="c1">#if self.age&gt;150: self.remove_me()</span>

        <span class="c1"># new_B=self.AGB+self.Biomass_gain()</span>
        <span class="c1"># self.DBH=self.DBH_from_Biomass(new_B)*100</span>
        <span class="c1">#if self.DBH&lt;=0: self.remove_me()</span>

    <span class="k">def</span> <span class="nf">calculate_Rc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">patch_CCA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">CCAs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">]</span>
        <span class="n">max_CCA</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">patch_CCA</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmin</span><span class="p">))</span>                                <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmax</span><span class="p">))],</span> <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CA</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">max_CCA</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">max_CCA</span>
        <span class="k">if</span> <span class="n">rc</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="Tree.calculate_Ms"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.calculate_Ms">[docs]</a>            <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_Ms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the size-dependent mortality for small trees according to model description in Ruger et al. 2007. (SI, page 4).</span>

<span class="sd">        Returns: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Ms</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmort</span><span class="p">:</span>
            <span class="n">Ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_max</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dmort</span><span class="p">)</span>
        <span class="c1"># elif self.DBH&gt;=self.max_dbh:</span>
        <span class="c1">#    Ms=self.m_max</span></div>

<div class="viewcode-block" id="Tree.stochastic_M"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.stochastic_M">[docs]</a>        <span class="k">return</span> <span class="n">Ms</span>

    <span class="k">def</span> <span class="nf">stochastic_M</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stochastic mortality.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (bools): True if tree should be removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if self.DBH&gt;=self.max_dbh:</span>
        <span class="c1">#    return True #np.random.random()&lt;= self.m_max</span>
        <span class="n">w_Mb</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">w_Mc</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">w_Md</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">M</span> <span class="o">=</span> <span class="p">((</span><span class="n">w_Mc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mc</span> <span class="o">+</span> <span class="n">w_Mb</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mb</span> <span class="o">+</span></div>
              <span class="n">w_Md</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Md</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">w_Mc</span> <span class="o">+</span> <span class="n">w_Mb</span> <span class="o">+</span> <span class="n">w_Md</span><span class="p">))</span>
<div class="viewcode-block" id="Tree.stochastic_Cm"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.stochastic_Cm">[docs]</a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">M</span>  <span class="c1"># *self.world.mortality_factor</span>

    <span class="k">def</span> <span class="nf">stochastic_Cm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stochastic crownding mortality.</span>

<span class="sd">        Returns: bool</span>
<span class="sd">            True if tree dies from crowding.</span></div>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Tree.stochastic_Bm"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.stochastic_Bm">[docs]</a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mc</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stochastic_Bm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stochastic Background mortality.</span>

<span class="sd">        Returns: bool</span>
<span class="sd">            True if tree dies from background mortality.</span></div>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Tree.stochastic_Dm"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.stochastic_Dm">[docs]</a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mb</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stochastic_Dm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stochastic damage mortality.</span>

<span class="sd">        Returns: bool</span>
<span class="sd">            True if tree dies from damage.</span></div>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Tree.log_me"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.log_me">[docs]</a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Md</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cut down this tree.</span>

<span class="sd">            Randomly determines where tree is going to fall and inflict damage in the the trees hit by the crown. Only trees with DBH&lt; 50 cm are damaged.</span>

<span class="sd">            The carbon of this trees is not added to any Stock.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Tree</span><span class="o">.</span><span class="n">DERIVED_TREES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftype</span><span class="p">]</span><span class="o">.</span><span class="n">Indices</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">trees_per_patch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1"># self.world.Smort+=self.AGB*0.44</span>

        <span class="n">topology</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span>

        <span class="nb">dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">*</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="nb">dir</span> <span class="o">/</span> <span class="mi">360</span><span class="p">)))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">*</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="nb">dir</span> <span class="o">/</span> <span class="mi">360</span><span class="p">)))</span>
        <span class="n">md</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CA</span> <span class="o">/</span> <span class="n">topology</span><span class="o">.</span><span class="n">patch_area</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">target_patch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">target_patch</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">target_patch</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_patch</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">target_patch</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">in_bounds</span><span class="p">(</span><span class="n">target_patch</span><span class="p">)</span>

        <span class="n">neighborhood</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">hood</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">target_patch</span><span class="p">,</span> <span class="n">remove_center</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">trees_in_neighborhood</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">trees_in_patches</span><span class="p">(</span><span class="n">neighborhood</span><span class="p">)</span>
        <span class="n">trees_in_circle</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span> <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">trees_in_neighborhood</span> <span class="k">if</span> <span class="n">topology</span><span class="o">.</span><span class="n">point_within_circle</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CD</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">topology</span><span class="o">.</span><span class="n">scaled_distance</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">topology</span><span class="o">.</span><span class="n">patch_area</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trees_in_circle</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">DBH</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">Md</span> <span class="o">=</span> <span class="n">md</span></div>

<div class="viewcode-block" id="Tree.remove_me"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.remove_me">[docs]</a>        <span class="k">del</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">remove_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kill this tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># subclass=&quot;Tree_&quot;+self.Ftype</span>
        <span class="c1"># globals()[subclass].Indices.remove(self.id)</span>
        <span class="n">Tree</span><span class="o">.</span><span class="n">DERIVED_TREES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftype</span><span class="p">]</span><span class="o">.</span><span class="n">Indices</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBH</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dfall</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfall</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fall</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">trees_per_patch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">Smort</span> <span class="o">+=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGB</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.44</span></div>
        <span class="n">Tree</span><span class="o">.</span><span class="n">DeadTrees</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftype</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<div class="viewcode-block" id="Tree.fall"><a class="viewcode-back" href="../tree_agent.html#tree_agent.Tree.fall">[docs]</a>        <span class="k">del</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">fall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inflict damage on other trees affected by the falling one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topology</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">topology</span>

        <span class="nb">dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">*</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="nb">dir</span> <span class="o">/</span> <span class="mi">360</span><span class="p">)))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">*</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="nb">dir</span> <span class="o">/</span> <span class="mi">360</span><span class="p">)))</span>
        <span class="n">md</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CA</span> <span class="o">/</span> <span class="n">topology</span><span class="o">.</span><span class="n">patch_area</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Damage caused on trees near the falling trees, due to lianas</span>

        <span class="n">neighborhood</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">hood</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">,</span> <span class="n">remove_center</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">trees_in_neighborhood</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">trees_in_patches</span><span class="p">(</span><span class="n">neighborhood</span><span class="p">)</span>
        <span class="n">trees_in_circle</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span> <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">trees_in_neighborhood</span> <span class="k">if</span> <span class="n">topology</span><span class="o">.</span><span class="n">point_within_circle</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CD</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">topology</span><span class="o">.</span><span class="n">scaled_distance</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">topology</span><span class="o">.</span><span class="n">patch_area</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trees_in_circle</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">H</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">Md</span> <span class="o">=</span> <span class="n">md</span> <span class="o">*</span> <span class="p">(</span><span class="n">topology</span><span class="o">.</span><span class="n">surface</span><span class="p">[</span><span class="n">topology</span><span class="o">.</span><span class="n">dim_names</span><span class="p">[</span><span class="s2">&quot;LianaCoverage&quot;</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">])</span>

        <span class="n">target_patch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">target_patch</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">target_patch</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_patch</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">target_patch</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">in_bounds</span><span class="p">(</span><span class="n">target_patch</span><span class="p">)</span>

        <span class="n">neighborhood</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">hood</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">target_patch</span><span class="p">,</span> <span class="n">remove_center</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">trees_in_neighborhood</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">trees_in_patches</span><span class="p">(</span><span class="n">neighborhood</span><span class="p">)</span>
        <span class="n">trees_in_circle</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span> <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">trees_in_neighborhood</span> <span class="k">if</span> <span class="n">topology</span><span class="o">.</span><span class="n">point_within_circle</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CD</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">topology</span><span class="o">.</span><span class="n">scaled_distance</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">topology</span><span class="o">.</span><span class="n">patch_area</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trees_in_circle</span><span class="p">:</span></div></div>
            <span class="k">if</span> <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">H</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">Tree</span><span class="o">.</span><span class="n">Instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">Md</span> <span class="o">=</span> <span class="n">md</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Fabio Frazao.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>